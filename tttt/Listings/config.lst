C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE CONFIG
OBJECT MODULE PLACED IN .\obj\config.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE config.c LARGE OBJECTADVANCED BROWSE INCDIR(..\T5L51) DEBUG PRINT(.\Listing
                    -s\config.lst) TABS(2) OBJECT(.\obj\config.obj)

line level    source

   1          /******************************************************************************
   2          
   3                            °æÈ¨ËùÓÐ (C), 2019, ±±¾©µÏÎÄ¿Æ¼¼ÓÐÏÞ¹«Ë¾
   4          
   5           ******************************************************************************
   6            ÎÄ ¼þ Ãû   : config.c
   7            °æ ±¾ ºÅ   : V2.0
   8            ×÷    Õß   : chengjing
   9            Éú³ÉÈÕÆÚ   : 2019Äê5ÔÂ14ÈÕ
  10            ¹¦ÄÜÃèÊö   : ´®¿Úº¯Êý
  11            ÐÞ¸ÄÀúÊ·   :
  12            1.ÈÕ    ÆÚ   : 
  13              ×÷    Õß   : 
  14              ÐÞ¸ÄÄÚÈÝ   : 
  15          ******************************************************************************/
  16          
  17          #include "config.h"
  18          #include "control.h"
  19          #include "timer.h"
  20          
  21          
  22          
  23          /************************************************/
  24          //²ÎÊýÖ÷¶¯ÉÏ´«
  25          u8  code Parm_Upload_Array[6]={0x5A,0xA5,0x26,0x00,0x00,0x60};
  26          //²ÎÊý¸Ä±ä±êÖ¾
  27          u8  Parm_Change_Flag=0;
  28          //´¥ÃþÊÂ¼þ²ÎÊý
  29          u16 data Touch_Event_Flag=0;
  30          //»Ö¸´Ä¬ÈÏ²ÎÊý
  31          u32 password_val=0;
  32          //¶¨Ê±Æ÷Ñ¡Ôñ
  33          u16 t_sel=0;
  34          //¶¨Ê±Æ÷Ê±¶ÎÑ¡Ôñ
  35          u16 p_sel=0;
  36          //ÉèÖÃ¶¨Ê±Ê±¼ä¶Î
  37          u16 timer_set_period[4]={0};
  38          //Ê±·ÖÉèÖÃÖµ
  39          u16 Hour_Min_Set=0;
  40          //²ÎÊýÉèÖÃ´íÎóÖµ
  41          u16 Parm_Set_Error_Val=0;
  42          //¶¨Ê±Æ÷ÐÇÆÚÉèÖÃ
  43          u16 timer_week_set[7]={0};
  44          //ÉèÖÃÎÂ¶ÈÉèÖÃÖµ
  45          u16 Set_Temperature_Set_Val=0;
  46          u16 Set_Temperature_Set_Val_Dec=0;
  47          //Ê±¼äÉèÖÃ½á¹¹Ìå
  48          RTC_Time_Set_Val RTC_Time_Set;
  49          //ÄÖÖÓÏÔÊ¾Ê±·Ö£¬µ¥¶ÀµØÖ·
  50          u16 Alarm_Display[4]={0};
  51          //ÄÖÖÓÉèÖÃÑ¡Ôñ
  52          u16 Alarm_Sel=0;
  53          //ÄÖÖÓÉèÖÃÖµ
  54          alarm_set alarm_set_val;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 2   

  55          //ÏûÏ¢×´Ì¬
  56          u16 Message_Status=0;
  57          //¸æ¾¯ÊÂ¼þÖµ
  58          u16 Warning_Val=0;
  59          //¶¨Ê±Æ÷Ê±¶ÎÐÇÆÚÏÔÊ¾
  60          u16 timer_period_display[8]={0};
  61          
  62          //¶¨Ê±Æ÷Ä£Ê½ÎÂ¶ÈÉèÖÃ
  63          u16 timer_speed_mode_set=0;
  64          u16 timer_temperature_set=0;
  65          //ÎÄ±¾Â¼Èë²ÎÊý
  66          data u16  Asc_num = 0;      //ÎÄ±¾±àºÅ
  67          u16  input_Ascdata[20] = (0);
  68          //¼üÅÌÂ¼ÈëÏà¹Ø
  69          u8  datact = 0;
  70          u8  datainput[20] = {0};
  71          
  72          void ASC_Data_Handler(void)
  73          {
  74   1        
  75   1          u8  input1[2],i;
  76   1      //  write_dgus_vp(0x3200,(u8*)&Asc_num,1);
  77   1          read_dgus_vp(ACS_IN,input1,1);
  78   1          if(input1[0]==0xa5)
  79   1          {
  80   2              input1[0] = 0;
  81   2              write_dgus_vp(ACS_IN,input1,1);
  82   2              if(input1[1]==0x01)               //É¾³ýµ¥¸ö×Ö·û
  83   2              {
  84   3                  if(datact!=0)
  85   3                  {
  86   4                    datainput[datact-1] = 0;
  87   4                    datact--;
  88   4                  }
  89   3              }
  90   2              else if(input1[1]==0x02)          //È¡ÏûÂ¼Èë£¬É¾³ýËùÓÐ×Ö·û
  91   2              {
  92   3                  for(i = 0;i<sizeof(datainput);i++)
  93   3                  {
  94   4                    datainput[i]=0;
  95   4                  }
  96   3                  datact = 0;
  97   3              }
  98   2              else if(input1[1]==0x03)          //È·ÈÏ£¬Â¼ÈëÍê±Ï
  99   2              {
 100   3                if(datainput[0]!=0)   //ÓÐÂ¼Èë
 101   3                {
 102   4                  switch(Asc_num)
 103   4                  {
 104   5                    case 0: 
 105   5                      write_dgus_vp(0x04B0,datainput,(sizeof(datainput))/2);
 106   5                      break;
 107   5                    case 1: 
 108   5                      write_dgus_vp(0x04C0,datainput,(sizeof(datainput))/2);
 109   5                      break;
 110   5                  }
 111   4                  
 112   4                  for(i = 0;i<sizeof(datainput);i++)
 113   4                  {
 114   5                    datainput[i]=0;
 115   5                  }
 116   4                  datact = 0;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 3   

 117   4                }
 118   3              }
 119   2              write_dgus_vp(0x2704,datainput,(sizeof(datainput))/2);
 120   2          }
 121   1          if(input1[0]==0x5a)
 122   1          {
 123   2              input1[0] = 0;
 124   2              write_dgus_vp(ACS_IN,input1,1);
 125   2              if(datact<(sizeof(datainput)-1))
 126   2              {
 127   3                  datainput[datact] = input1[1];
 128   3                  datainput[datact+1] = '\0';
 129   3                  datact++;
 130   3              }
 131   2              write_dgus_vp(0x2704,datainput,(sizeof(datainput))/2);
 132   2          }
 133   1        
 134   1        
 135   1      }
 136          void M4G6_Handler(void)
 137          {
 138   1        u8  m4g6data[2]=(0);
 139   1        read_dgus_vp(M4G6data_IN,m4g6data,1);
 140   1        if(m4g6data[0]==0x5A)
 141   1        {
 142   2          m4g6data[0] = 0;
 143   2          write_dgus_vp(M4G6data_IN,m4g6data,1);
 144   2          M4G6_DataDeal(m4g6data[1]);
 145   2          
 146   2        }
 147   1        
 148   1      }
 149          /*****************************************************************************
 150           º¯ Êý Ãû  : void Parm_Set_Function(void)
 151           ¹¦ÄÜÃèÊö  : ÎÂ¿ØÆ÷ÉèÖÃ´¦Àíº¯Êý
 152           ÊäÈë²ÎÊý  :  
 153           Êä³ö²ÎÊý  : 
 154           ÐÞ¸ÄÀúÊ·  :
 155            1.ÈÕ    ÆÚ   : 2019Äê5ÔÂ14ÈÕ
 156              ×÷    Õß   : chengjing
 157              ÐÞ¸ÄÄÚÈÝ   : ´´½¨
 158          *****************************************************************************/
 159          void Parm_Set_Function(void)
 160          {
 161   1        M4G6_Handler();
 162   1        read_dgus_vp(TOUCH_EVENT_FLAG,(u8*)&Touch_Event_Flag,1);
 163   1        if(Touch_Event_Flag>0)
 164   1        {
 165   2          switch(Touch_Event_Flag)
 166   2          {
 167   3            case  STANDBY_BOOT:
 168   3              Standby_Boot_Handler();           
 169   3              break;
 170   3            case  SHUT_DOWN_CONFIRM:
 171   3              Shut_Down_Confirm_Handler();    //Ò³ÃæÌø×ª            
 172   3              break;
 173   3            case  SYSTEM_SET_ENTER:
 174   3              System_Set_Enter_Handler();         
 175   3              break;
 176   3            case  PASSWORD_INPUT_CONFIRM:
 177   3              Password_Input_Confirm_Handler();
 178   3              break;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 4   

 179   3            case  PASSWORD_INPUT_CANCEL:
 180   3              Password_Input_Cancel_Handler();
 181   3              break;
 182   3            case  RESET_CONFIRM:
 183   3              Reset_Confirm_Handler();
 184   3              break;
 185   3            case  RESET_CANCEL:
 186   3              Reset_Cancel_Handler();
 187   3              break;
 188   3            case  SYSTEM_SET_RETURN:
 189   3              System_Set_Return_Handler();
 190   3              break;
 191   3            case  ALARM_SELECT_RETURN:
 192   3              Alarm_Select_Return_Handler();
 193   3              break;
 194   3            case  ADVANCE_SET_RETURN:
 195   3              Advance_Set_Rerurn_Handler();
 196   3              break;      
 197   3            case  TIMER_SET_ENTER:
 198   3              Timer_Week_Display();
 199   3              break;
 200   3            case  TIMER1_SET_ENTER:
 201   3              t_sel=0;
 202   3              Timer_Sel_Init_Handler(t_sel);
 203   3              break;
 204   3            case  TIMER2_SET_ENTER:
 205   3              t_sel=1;
 206   3              Timer_Sel_Init_Handler(t_sel);
 207   3              break;
 208   3            case  TIMER3_SET_ENTER:
 209   3              t_sel=2;
 210   3              Timer_Sel_Init_Handler(t_sel);
 211   3              break;
 212   3            case  TIMER_SET_PERIOD1:
 213   3              p_sel=0;
 214   3              Save_Week_Handler(t_sel);
 215   3              Timer_Period_Sel_Init_Handler(t_sel,p_sel);
 216   3              break;
 217   3            case  TIMER_SET_PERIOD2:
 218   3              p_sel=1;
 219   3              Save_Week_Handler(t_sel);
 220   3              Timer_Period_Sel_Init_Handler(t_sel,p_sel);
 221   3              break;
 222   3            case  TIMER_SET_PERIOD3:
 223   3              p_sel=2;
 224   3              Save_Week_Handler(t_sel);
 225   3              Timer_Period_Sel_Init_Handler(t_sel,p_sel);
 226   3              break;
 227   3            case  TIMER_SET_PERIOD4:
 228   3              p_sel=3;
 229   3              Save_Week_Handler(t_sel);
 230   3              Timer_Period_Sel_Init_Handler(t_sel,p_sel);
 231   3              break;
 232   3            case  TIMER_TIME_SET_CONFIRM:
 233   3              Timer_Time_Set_Confirm_Handler(t_sel,p_sel);
 234   3              break;
 235   3            case  TIMER_TIME_SET_CANCEL:
 236   3              Timer_Time_Set_Cancel_Handler();
 237   3              break;
 238   3            case  TIMER_SPEED_MODE_SET_CONFIRM:
 239   3              Timer_Speed_Mode_Set_Confirm_Handler(t_sel,p_sel);
 240   3              Timer_Sel_Init_Handler(t_sel);
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 5   

 241   3              break;
 242   3            case  TIMER_SPEED_MODE_SET_CANCEL:
 243   3              Timer_Speed_Mode_Set_Cancel_Handler();
 244   3              break;
 245   3            case  TIMER_WEEK_RETURN:
 246   3              Save_Week_Handler(t_sel);
 247   3              Timer_Week_Display();
 248   3              break;
 249   3            case  TIMER_SELECT_RETURN:
 250   3              Timer_Select_Return_Handler();
 251   3              break;
 252   3            case  TEMPERATURE_SET_ENTER:
 253   3              Temperature_Set_Enter_Init_Handler();
 254   3              break;
 255   3            case  TEMPERATURE_SET_CONFIRM:
 256   3              Temperature_Set_Confirm_Handler();
 257   3              break;
 258   3            case  TEMPERATURE_SET_CANCEL:
 259   3              Temperature_Set_Cancel_Handler();
 260   3              break;
 261   3            case  TEMPERATURE_SET_INCREASE:
 262   3              Temperature_Set_Increase();
 263   3              break;
 264   3            case  TEMPERATURE_SET_DECREASE:
 265   3              Tmeperature_Set_Decrease();
 266   3              break;
 267   3            case  TIME_SET_ENTER:
 268   3              Time_Set_Init_Handler();
 269   3              break;
 270   3            case  TIME_SET_CONFIRM:
 271   3              Time_Set_Confirm_Handler();
 272   3              break;
 273   3            case  TIME_SET_CANCEL:
 274   3              Time_Set_Cancel_Handler();
 275   3              break;
 276   3            case  ALARM_SET_ENTER:
 277   3              Alarm_Set_Init_Handler();
 278   3              break;
 279   3            case  ALARM1_SET_ENTER:
 280   3              Alarm_Sel=0x01;
 281   3              Alarm_Set_Handler(Alarm_Sel);       
 282   3              break;
 283   3            case  ALARM2_SET_ENTER:
 284   3              Alarm_Sel=0x02;
 285   3              Alarm_Set_Handler(Alarm_Sel);
 286   3              break;
 287   3            case  ALARM_SET_CONFIRM:
 288   3              Alarm_Set_Confirm_Handler(Alarm_Sel);
 289   3              Alarm_Set_Init_Handler();
 290   3              break;
 291   3            case  ALARM_SET_CANCEL:
 292   3              Alarm_Set_Cancel_Handler();
 293   3              break;
 294   3            case  MESSAGE_READ_CONFIRM:
 295   3              Message_Handler();
 296   3              break;
 297   3            case  SHUT_DOWN:
 298   3              Shut_Down_Handler();
 299   3              break;
 300   3            case  RETURN_MAIN:
 301   3              Return_Main_page();
 302   3              break;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 6   

 303   3            case  SPEED_AUTO:
 304   3              Speed_Auto_Set_Handler();
 305   3              break;
 306   3            case  SPEED_LOW:
 307   3              Speed_Low_Set_Handler();
 308   3              break;
 309   3            case  SPEED_MIDIUM:
 310   3              Speed_Medium_Set_Handler();
 311   3              break;
 312   3            case  SPEED_HIGH:
 313   3              Speed_High_Set_Handler();
 314   3              break;
 315   3            case  SPEED_ADD:
 316   3              Speed_Add_Set_Handler();
 317   3              break;
 318   3            case  SPEED_DECREASE:
 319   3              Speed_Decrease_Set_Handler();
 320   3              break;
 321   3            case  MODE_ADD:
 322   3              Mode_Add_Set_Handler();
 323   3              break;
 324   3            case  ASC_PUTIN1:
 325   3              Asc_Input_Handler(ASC_PUTIN1);
 326   3              break;
 327   3            case  ASC_PUTIN2:
 328   3              Asc_Input_Handler(ASC_PUTIN2);
 329   3              break;
 330   3            default:
 331   3              break;
 332   3          }
 333   2          Parm_Change_Flag=0x01;        //²ÎÊý¸Ä±ä£¬±£´æ±êÖ¾Î»
 334   2          Touch_Event_Flag=0;         //ÇåÁã
 335   2          write_dgus_vp(TOUCH_EVENT_FLAG,(u8*)&Touch_Event_Flag,1);
 336   2          Parm_Upload_Handler();
 337   2        }
 338   1        Parm_Set_Error_Handler();     //²ÎÊýÉèÖÃ´íÎó£¬Ìø×ªÒ³Ãæ
 339   1        Warning_Event_Handler();  
 340   1        Save_Data_Handler();        //±£´ænor flash
 341   1        ASC_Data_Handler();
 342   1      }
 343          
 344          //·µ»ØÖ÷½çÃæ
 345          void Return_Main_page(void)
 346          {
 347   1        page_set[0]=0x5A;
 348   1        page_set[1]=0x01;
 349   1        page_set[2]=0x00;
 350   1        switch (Mode)
 351   1        {
 352   2          case 1: page_set[3]= 3;break;   //ÖÆÀä
 353   2          case 2: page_set[3]= 2;break;   //ÖÆÈÈ
 354   2          case 3: page_set[3]= 1;break;     //ËÍ·ç
 355   2        }
 356   1        write_dgus_vp(PIC_SET,page_set,2);
 357   1      }
 358          void Parm_Upload_Handler(void)
 359          {
 360   1        write_dgus_vp(RMA,(u8*)&Parm_Upload_Array,3);
 361   1      }
 362          
 363          
 364          void Standby_Boot_Handler(void)
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 7   

 365          {
 366   1        read_dgus_vp(SWITCH,(u8*)&TC_Status,1);
 367   1        if(TC_Status==1)
 368   1        {
 369   2          Standby_Handler();      //ÐÝÃß    
 370   2        }
 371   1        else if(TC_Status==2)
 372   1        {
 373   2          Boot_Handler();       //¿ª»ú    
 374   2        }
 375   1      }
 376          
 377          void Shut_Down_Confirm_Handler(void)
 378          {
 379   1        Warning_Val=0x1001;
 380   1        write_dgus_vp(WARNING_EVENT,(u8*)&Warning_Val,1);   //Ð´Öµ
 381   1      }
 382          
 383          void System_Set_Enter_Handler(void)
 384          {
 385   1        
 386   1      //    page_set[0]=0x5A;
 387   1      //    page_set[1]=0x01;
 388   1      //    page_set[2]=0x00;
 389   1      //    page_set[3]=(u8)Screen_Saver_Parm[1];
 390   1      //    write_dgus_vp(PIC_SET,page_set,2);
 391   1      }
 392          
 393          
 394          void Password_Input_Confirm_Handler(void)
 395          {
 396   1        read_dgus_vp(PASSWORD_INPUT,(u8*)&password_val,2);
 397   1        if(password_val!=Password)
 398   1        {
 399   2          Parm_Set_Error_Val=0x1003;
 400   2          write_dgus_vp(PARM_SET_ERROR,(u8*)&Parm_Set_Error_Val,1);
 401   2        }
 402   1        else
 403   1        {
 404   2          
 405   2        }
 406   1      }
 407          
 408          void Password_Input_Cancel_Handler(void)
 409          {
 410   1        password_val=0;
 411   1        write_dgus_vp(PASSWORD_INPUT,(u8*)&password_val,2);
 412   1      }
 413          
 414          void Reset_Confirm_Handler(void)
 415          {
 416   1        Parm_Reset_Init();        //ÏµÍ³²ÎÊý¸´Î»
 417   1        password_val=0;
 418   1        write_dgus_vp(PASSWORD_INPUT,(u8*)&password_val,2);
 419   1        Return_Main_page();
 420   1      }
 421          
 422          void Reset_Cancel_Handler(void)
 423          {
 424   1        //¿ÉÒÔ²»ÐèÒª´¦Àí
 425   1      }
 426          
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 8   

 427          
 428          void System_Set_Return_Handler(void)
 429          {
 430   1        //¿ÉÒÔ²»ÐèÒª´¦Àí
 431   1      }
 432          
 433          
 434          void Alarm_Select_Return_Handler(void)
 435          {
 436   1        //¿ÉÒÔ²»ÐèÒª´¦Àí
 437   1      }
 438          
 439          void Advance_Set_Rerurn_Handler(void)
 440          {
 441   1        //¿ÉÒÔ²»ÐèÒª´¦Àí
 442   1      }
 443          
 444          
 445          
 446          /*****************************************************************************
 447           º¯ Êý Ãû  : void Week_Val(u16 time_sel)
 448           ¹¦ÄÜÃèÊö  : ¶¨Ê±Æ÷ÐÇÆÚ´¦Àíº¯Êý
 449           ÊäÈë²ÎÊý  :   time_sel£º¶¨Ê±Æ÷ÐÇÆÚ±£´æÖµ 
 450           Êä³ö²ÎÊý  : 
 451           ÐÞ¸ÄÀúÊ·  :
 452            1.ÈÕ    ÆÚ   : 2019Äê4ÔÂ2ÈÕ
 453              ×÷    Õß   : chengjing
 454              ÐÞ¸ÄÄÚÈÝ   : ´´½¨
 455          *****************************************************************************/
 456          void Week_Val(u16 time_sel)
 457          {
 458   1        if((tim_week_c[time_sel]&0x01)==0x01)
 459   1          timer_week[time_sel][0]=1;
 460   1        else
 461   1          timer_week[time_sel][0]=0;
 462   1        if((tim_week_c[time_sel]&0x02)==0x02)
 463   1          timer_week[time_sel][1]=1;
 464   1        else 
 465   1          timer_week[time_sel][1]=0;
 466   1        if((tim_week_c[time_sel]&0x04)==0x04)
 467   1          timer_week[time_sel][2]=1;
 468   1        else
 469   1          timer_week[time_sel][2]=0;
 470   1        if((tim_week_c[time_sel]&0x08)==0x08)
 471   1          timer_week[time_sel][3]=1;
 472   1        else
 473   1          timer_week[time_sel][3]=0;
 474   1        if((tim_week_c[time_sel]&0x10)==0x10)
 475   1          timer_week[time_sel][4]=1;
 476   1        else
 477   1          timer_week[time_sel][4]=0;
 478   1        if((tim_week_c[time_sel]&0x20)==0x20)
 479   1          timer_week[time_sel][5]=1;
 480   1        else
 481   1          timer_week[time_sel][5]=0;
 482   1        if((tim_week_c[time_sel]&0x40)==0x40)
 483   1          timer_week[time_sel][6]=1;
 484   1        else
 485   1          timer_week[time_sel][6]=0;
 486   1      }
 487          
 488          
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 9   

 489          
 490          /*****************************************************************************
 491           º¯ Êý Ãû  : void Timer_Week_Display(void)
 492           ¹¦ÄÜÃèÊö  : ¶¨Ê±Æ÷ÐÇÆÚÏÔÊ¾º¯Êý
 493           ÊäÈë²ÎÊý  :   
 494           Êä³ö²ÎÊý  : 
 495           ÐÞ¸ÄÀúÊ·  :
 496            1.ÈÕ    ÆÚ   : 2019Äê4ÔÂ2ÈÕ
 497              ×÷    Õß   : chengjing
 498              ÐÞ¸ÄÄÚÈÝ   : ´´½¨
 499          *****************************************************************************/
 500          void Timer_Week_Display(void)
 501          {
 502   1        u8 i=0;
 503   1        read_dgus_vp(TIMER1_WEEK,(u8*)&tim_week_c[0],1);
 504   1        read_dgus_vp(TIMER2_WEEK,(u8*)&tim_week_c[1],1);
 505   1        read_dgus_vp(TIMER3_WEEK,(u8*)&tim_week_c[2],1);
 506   1        for(i=0;i<3;i++)
 507   1        {
 508   2          Week_Val(i);
 509   2        }
 510   1        write_dgus_vp(TIMER_WEEK_DISPLAY,(u8*)&timer_week[0][0],21);  
 511   1      }
 512          
 513          
 514          
 515          
 516          
 517          /*****************************************************************************
 518           º¯ Êý Ãû  : void Timer_Select_Init_Handler(u16 t_sel)
 519           ¹¦ÄÜÃèÊö  : ¶¨Ê±Æ÷Ñ¡Ôñ³õÊ¼»¯¸³Öµ
 520           ÊäÈë²ÎÊý  :   t_sel£º¶¨Ê±Æ÷Ñ¡Ôñ
 521           Êä³ö²ÎÊý  : 
 522           ÐÞ¸ÄÀúÊ·  :
 523            1.ÈÕ    ÆÚ   : 2019Äê5ÔÂ14ÈÕ
 524              ×÷    Õß   : chengjing
 525              ÐÞ¸ÄÄÚÈÝ   : ´´½¨
 526          *****************************************************************************/
 527          void Timer_Sel_Init_Handler(u16 t_sel)
 528          {
 529   1        u8 i=0;
 530   1        if(t_sel==0)
 531   1        {
 532   2          read_dgus_vp(TIMER1_TIME_SEED_MODE,(u8*)&tim_per_val[0][0],16);       
 533   2        }
 534   1        else if(t_sel==1)
 535   1        {
 536   2          read_dgus_vp(TIMER2_TIME_SEED_MODE,(u8*)&tim_per_val[1][0],16);
 537   2        }
 538   1        else if(t_sel==2)
 539   1        {
 540   2          read_dgus_vp(TIMER3_TIME_SEED_MODE,(u8*)&tim_per_val[2][0],16);
 541   2        }
 542   1        for(i=0;i<4;i++)
 543   1        {
 544   2          timer_period_display[i*2]=tim_per_val[t_sel][i].timer_time_start+25700;
 545   2          timer_period_display[i*2+1]=tim_per_val[t_sel][i].timer_time_end+25700;
 546   2        }
 547   1        write_dgus_vp(TIMER_DISPLAY_PERIOD,(u8*)timer_period_display,8);  
 548   1        write_dgus_vp(TIMER_WEEK_SET,(u8*)&timer_week[t_sel][0],7);
 549   1      }
 550          
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 10  

 551          
 552          
 553          void Timer_Period_Sel_Init_Handler(u16 t_sel,u16 p_sel)
 554          { 
 555   1        timer_set_period[0]=tim_per_val[t_sel][p_sel].timer_time_start/256;
 556   1        timer_set_period[1]=tim_per_val[t_sel][p_sel].timer_time_start%256;
 557   1        timer_set_period[2]=tim_per_val[t_sel][p_sel].timer_time_end/256+100;
 558   1        timer_set_period[3]=tim_per_val[t_sel][p_sel].timer_time_end%256+100;
 559   1        write_dgus_vp(TIMER_SET_TIME_START,(u8*)&timer_set_period[0],1);
 560   1        write_dgus_vp(TIMER_SET_TIME_END,(u8*)&timer_set_period[1],1);
 561   1        write_dgus_vp(TIMER_DISPLAY_TIME_ST,(u8*)&timer_set_period[2],2);
 562   1        timer_speed_mode_set=tim_per_val[t_sel][p_sel].timer_speed;
 563   1        timer_temperature_set=tim_per_val[t_sel][p_sel].time_temperture/10;
 564   1        write_dgus_vp(TIMER_SET_SPEED,(u8*)&timer_speed_mode_set,1);
 565   1        write_dgus_vp(TIMER_SET_TEMP,(u8*)&timer_temperature_set,1);  
 566   1      }
 567          
 568          u8 Timer_Time_Set_Confirm_Handler(u16 t_sel,u16 p_sel)
 569          {
 570   1        u8 i=0;
 571   1        read_dgus_vp(TIMER_SET_TIME_START,(u8*)&timer_set_period[0],1);
 572   1        read_dgus_vp(TIMER_SET_TIME_END,(u8*)&timer_set_period[1],1);
 573   1        Hour_Min_Set=timer_set_period[0]*256+timer_set_period[1];
 574   1        if((Hour_Min_Set<tim_per_val[t_sel][p_sel-1].timer_time_start)&&(p_sel>=1))   //ÊäÈëÊ±¼äÐ¡ÓÚÉÏÒ»¸öÊäÈëÊ±¼ä
             -£¬ÅÐ¶ÏÎªÊäÈëÊ±¼ä´íÎó
 575   1        {   
 576   2          Parm_Set_Error_Val=0x1004;    //Ìø×ªµ½²ÎÊýÉèÖÃ´íÎóÒ³Ãæ,±ØÐë·µ»Ø
 577   2          write_dgus_vp(PARM_SET_ERROR,(u8*)&Parm_Set_Error_Val,1);
 578   2          return 1;
 579   2        }
 580   1        if((Hour_Min_Set>tim_per_val[t_sel][p_sel].timer_time_end)&&(p_sel<=2))   //ÊäÈëÊ±¼ä´óÓÚºóÒ»¸öÉèÖÃÊ±¼ä,ºóÃ
             -æÉèÖÃÊ±¼äÇåÁã
 581   1        {
 582   2          for(i=p_sel;i<3;i++)
 583   2          {
 584   3            tim_per_val[t_sel][i].timer_time_end=0;
 585   3            tim_per_val[t_sel][i+1].timer_time_start=0;
 586   3          }
 587   2        }
 588   1        if(p_sel==0)
 589   1        {
 590   2          tim_per_val[t_sel][0].timer_time_start=Hour_Min_Set;
 591   2          tim_per_val[t_sel][3].timer_time_end=Hour_Min_Set;
 592   2        }
 593   1        else
 594   1        {
 595   2          tim_per_val[t_sel][p_sel].timer_time_start=Hour_Min_Set;
 596   2          tim_per_val[t_sel][p_sel-1].timer_time_end=Hour_Min_Set;
 597   2        }
 598   1        return 0;
 599   1      }
 600          
 601          
 602          
 603          void Timer_Time_Set_Cancel_Handler(void)
 604          {
 605   1        
 606   1      }
 607          
 608          
 609          
 610          u8 Timer_Speed_Mode_Set_Confirm_Handler(u16 t_sel,u16 p_sel)
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 11  

 611          {
 612   1        read_dgus_vp(TIMER_SET_SPEED,(u8*)&timer_speed_mode_set,1);
 613   1        read_dgus_vp(TIMER_SET_TEMP,(u8*)&timer_temperature_set,1);
 614   1        if(timer_speed_mode_set==0)
 615   1        {
 616   2          Parm_Set_Error_Val=0x1005;
 617   2          write_dgus_vp(PARM_SET_ERROR,(u8*)&Parm_Set_Error_Val,1);   //·çËÙÉèÖÃ´íÎó£¬Ìø×ªÒ³Ãæ
 618   2          return 1;
 619   2        }
 620   1        if(timer_temperature_set==0)
 621   1        {
 622   2          Parm_Set_Error_Val=0x1005;
 623   2          write_dgus_vp(PARM_SET_ERROR,(u8*)&Parm_Set_Error_Val,1);   //ÎÂ¶ÈÉèÖÃ´íÎó£¬Ìø×ªÒ³Ãæ  
 624   2          return 2;
 625   2        }
 626   1        tim_per_val[t_sel][p_sel].timer_speed=timer_speed_mode_set;
 627   1        tim_per_val[t_sel][p_sel].time_temperture=timer_temperature_set*10;
 628   1        if(t_sel==0)
 629   1        {
 630   2          write_dgus_vp(TIMER1_TIME_SEED_MODE,(u8*)&tim_per_val[0][0],16);  //Ð´ÈëÐÞ¸Ä²ÎÊý      
 631   2        }
 632   1        else if(t_sel==1)
 633   1        {
 634   2          write_dgus_vp(TIMER2_TIME_SEED_MODE,(u8*)&tim_per_val[1][0],16);
 635   2        }
 636   1        else if(t_sel==2)
 637   1        {
 638   2          write_dgus_vp(TIMER3_TIME_SEED_MODE,(u8*)&tim_per_val[2][0],16);
 639   2        }
 640   1        return 0;
 641   1      }
 642          
 643          void Timer_Speed_Mode_Set_Cancel_Handler(void)
 644          {
 645   1        
 646   1      }
 647          
 648          
 649          /*****************************************************************************
 650           º¯ Êý Ãû  : void Save_Week_Handler(u16 t_sel)
 651           ¹¦ÄÜÃèÊö  : ±£´æÐÇÆÚ´¦Àíº¯Êý
 652           ÊäÈë²ÎÊý  :   t_sel£º¶¨Ê±Æ÷Ñ¡Ôñ
 653           Êä³ö²ÎÊý  : 
 654           ÐÞ¸ÄÀúÊ·  :
 655            1.ÈÕ    ÆÚ   : 2019Äê5ÔÂ15ÈÕ
 656              ×÷    Õß   : chengjing
 657              ÐÞ¸ÄÄÚÈÝ   : ÐÞ¸Ä
 658          *****************************************************************************/
 659          void Save_Week_Handler(u16 t_sel)
 660          {
 661   1        u8 i=0;
 662   1        read_dgus_vp(TIMER_WEEK_SET,(u8*)timer_week_set,7);
 663   1        for(i=0;i<7;i++)
 664   1        {
 665   2          if(timer_week_set[i]==1)
 666   2          {
 667   3            timer_week[t_sel][i]=1;
 668   3            tim_week_c[t_sel] |= (0x01<<i);
 669   3          }
 670   2          else
 671   2          {
 672   3            timer_week[t_sel][i]=0;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 12  

 673   3            tim_week_c[t_sel] &= ~(0x01<<i);
 674   3          }
 675   2        }
 676   1        write_dgus_vp(TIMER_WEEK_DISPLAY,(u8*)&timer_week[0][0],21);
 677   1        if(t_sel==0)
 678   1        {
 679   2          write_dgus_vp(TIMER1_WEEK,(u8*)&tim_week_c[0],1);
 680   2        }
 681   1        else if(t_sel==1)
 682   1        {
 683   2          write_dgus_vp(TIMER2_WEEK,(u8*)&tim_week_c[1],1);
 684   2        }
 685   1        else if(t_sel==2)
 686   1        {
 687   2          write_dgus_vp(TIMER3_WEEK,(u8*)&tim_week_c[2],1);
 688   2        }
 689   1      }
 690          
 691          
 692          void Timer_Select_Return_Handler(void)
 693          {
 694   1      
 695   1      }
 696          
 697          
 698          
 699          void Temperature_Set_Enter_Init_Handler(void)
 700          {
 701   1        read_dgus_vp(TEMP_SET,(u8*)&Temperature_Set_Val,1);
 702   1        Set_Temperature_Set_Val=Temperature_Set_Val/10;
 703   1        Set_Temperature_Set_Val_Dec=Temperature_Set_Val%10;
 704   1        write_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1);
 705   1        write_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 706   1      }
 707          
 708          void Temperature_Set_Confirm_Handler(void)
 709          {
 710   1        read_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1); 
 711   1        read_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 712   1        if((Set_Temperature_Set_Val_Dec<=9)&&(Set_Temperature_Set_Val<=32)&&(Set_Temperature_Set_Val>=16))
 713   1        {
 714   2          Temperature_Set_Val=Set_Temperature_Set_Val*10+Set_Temperature_Set_Val_Dec;
 715   2        }
 716   1        else
 717   1        {
 718   2          return;
 719   2        }
 720   1        write_dgus_vp(TEMP_SET,(u8*)&Temperature_Set_Val,1);
 721   1        return;
 722   1      }
 723          
 724          void Temperature_Set_Cancel_Handler(void)
 725          {
 726   1        
 727   1      }
 728          
 729          void Temperature_Set_Increase(void)
 730          {
 731   1        u16 temp;
 732   1        read_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1); 
 733   1        read_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 734   1        temp=Set_Temperature_Set_Val*10+Set_Temperature_Set_Val_Dec+Temp_Pre;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 13  

 735   1        if(temp>Temperature_Upper)
 736   1        {
 737   2          temp=Temperature_Upper;
 738   2        }
 739   1        if(temp<Temperature_Lower)
 740   1        {
 741   2          temp=Temperature_Lower;
 742   2        }
 743   1        Set_Temperature_Set_Val=temp/10;
 744   1        Set_Temperature_Set_Val_Dec=temp%10;
 745   1        write_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1);  
 746   1        write_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 747   1      }
 748          
 749          void Tmeperature_Set_Decrease(void)
 750          {
 751   1        u16 temp;
 752   1        read_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1); 
 753   1        read_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 754   1        temp=Set_Temperature_Set_Val*10+Set_Temperature_Set_Val_Dec-Temp_Pre;
 755   1        if(temp>Temperature_Upper)
 756   1        {
 757   2          temp=Temperature_Upper;
 758   2        }
 759   1        if(temp<Temperature_Lower)
 760   1        {
 761   2          temp=Temperature_Lower;
 762   2        }
 763   1        Set_Temperature_Set_Val=temp/10;
 764   1        Set_Temperature_Set_Val_Dec=temp%10;
 765   1        write_dgus_vp(SET_TEMP_SET_VALUE,(u8*)&Set_Temperature_Set_Val,1);  
 766   1        write_dgus_vp(SET_TEMP_SET_VAL_DEC,(u8*)&Set_Temperature_Set_Val_Dec,1);
 767   1      }
 768          
 769          
 770          void Time_Set_Init_Handler(void)
 771          {
 772   1        RTC_Time_Set.year=real_time.year+25600;
 773   1        RTC_Time_Set.month=real_time.month+25600;
 774   1        RTC_Time_Set.day=real_time.day+25600;
 775   1        RTC_Time_Set.hour=real_time.hour+25600;
 776   1        RTC_Time_Set.min=real_time.min+25600;
 777   1        write_dgus_vp(TIME_SET_VALUE,(u8*)&RTC_Time_Set,5);
 778   1      }
 779          
 780          void Time_Set_Confirm_Handler(void)
 781          {
 782   1        read_dgus_vp(TIME_SET_VALUE,(u8*)&RTC_Time_Set,5);
 783   1        RTC_Time_Set.year-=25600;
 784   1        RTC_Time_Set.month-=25600;
 785   1        RTC_Time_Set.day-=25600;
 786   1        RTC_Time_Set.hour-=25600;
 787   1        RTC_Time_Set.min-=25600;
 788   1        if(RTC_Time_Set.day>mon_table[RTC_Time_Set.month-1])
 789   1        {
 790   2          if(RTC_Time_Set.month==2)
 791   2          {
 792   3            if(Is_Leap_Year(RTC_Time_Set.year))
 793   3            {
 794   4              if(RTC_Time_Set.day>29)
 795   4              {
 796   5                RTC_Time_Set.day=mon_table[RTC_Time_Set.month-1]+1;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 14  

 797   5              }
 798   4            }
 799   3          }
 800   2          else
 801   2          {
 802   3            RTC_Time_Set.day=mon_table[RTC_Time_Set.month-1];
 803   3          }   
 804   2        } 
 805   1        if(RTC_Time_Set.month==0)
 806   1        {
 807   2          RTC_Time_Set.month=1;
 808   2        }
 809   1        if(RTC_Time_Set.day==0)
 810   1        {
 811   2          RTC_Time_Set.day=1;
 812   2        }
 813   1        time_calibra[0]=0x5A;
 814   1        time_calibra[1]=0xA5;
 815   1        time_calibra[2]=RTC_Time_Set.year;
 816   1        time_calibra[3]=RTC_Time_Set.month;
 817   1        time_calibra[4]=RTC_Time_Set.day;
 818   1        time_calibra[5]=RTC_Time_Set.hour;
 819   1        time_calibra[6]=RTC_Time_Set.min;
 820   1        time_calibra[7]=0;
 821   1      //  write_dgus_vp(RTC_Set,(u8*)time_calibra,4); 
 822   1        RTC_Reset(time_calibra);
 823   1              Return_Main_page();
 824   1      }
 825          
 826          
 827          void Time_Set_Cancel_Handler(void)
 828          {
 829   1        
 830   1              Return_Main_page();
 831   1      }
 832          
 833          
 834          
 835          
 836          void Alarm_Set_Init_Handler(void)
 837          {
 838   1        read_dgus_vp(ALARM_VAL,(u8*)&alarm_val,4);
 839   1        Alarm_Display[0]=alarm_val.alarm1_time/256+100;
 840   1        Alarm_Display[1]=alarm_val.alarm1_time%256+100;
 841   1        Alarm_Display[2]=alarm_val.alarm2_time/256+100;
 842   1        Alarm_Display[3]=alarm_val.alarm2_time%256+100;
 843   1        write_dgus_vp(ALARM_DISPLAY_TIME,(u8*)Alarm_Display,4);
 844   1      }
 845          
 846          void Alarm_Set_Handler(u16 alarm_sel)
 847          {
 848   1        read_dgus_vp(ALARM_VAL,(u8*)&alarm_val,4);
 849   1        if(alarm_sel==0x01)
 850   1        {
 851   2          alarm_set_val.alarm_time_hour=alarm_val.alarm1_time/256+25600;
 852   2          alarm_set_val.alarm_time_min=alarm_val.alarm1_time%256+25600;
 853   2          alarm_set_val.alarm_ring=alarm_val.alarm1_ring;
 854   2        }
 855   1        else if(alarm_sel==0x02)
 856   1        {
 857   2          alarm_set_val.alarm_time_hour=alarm_val.alarm2_time/256+25600;
 858   2          alarm_set_val.alarm_time_min=alarm_val.alarm2_time%256+25600;
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 15  

 859   2          alarm_set_val.alarm_ring=alarm_val.alarm2_ring;
 860   2        }
 861   1        write_dgus_vp(ALARM_SET_VAL,(u8*)&alarm_set_val,3); 
 862   1      }
 863          
 864          void Alarm_Set_Confirm_Handler(u16 alarm_sel)
 865          {
 866   1        read_dgus_vp(ALARM_SET_VAL,(u8*)&alarm_set_val,3);  
 867   1        if(alarm_sel==0x01)
 868   1        {
 869   2          alarm_val.alarm1_time=(alarm_set_val.alarm_time_hour-25600)*256+(alarm_set_val.alarm_time_min-25600);
 870   2          alarm_val.alarm1_ring=alarm_set_val.alarm_ring;
 871   2        }
 872   1        else if(alarm_sel==0x02)
 873   1        {
 874   2          alarm_val.alarm2_time=(alarm_set_val.alarm_time_hour-25600)*256+(alarm_set_val.alarm_time_min-25600);
 875   2          alarm_val.alarm2_ring=alarm_set_val.alarm_ring;
 876   2        }
 877   1        write_dgus_vp(ALARM_VAL,(u8*)&alarm_val,4);
 878   1      }
 879          
 880          
 881          void Alarm_Set_Cancel_Handler(void)
 882          {
 883   1        
 884   1      }
 885          
 886          /*****************************************************************************
 887           º¯ Êý Ãû  : void Message_Handler(void)
 888           ¹¦ÄÜÃèÊö  : ÏûÏ¢´¦Àíº¯Êý
 889           ÊäÈë²ÎÊý  :  
 890           Êä³ö²ÎÊý  : 
 891           ÐÞ¸ÄÀúÊ·  :
 892            1.ÈÕ    ÆÚ   : 2019Äê4ÔÂ30ÈÕ
 893              ×÷    Õß   : chengjing
 894              ÐÞ¸ÄÄÚÈÝ   : ´´½¨
 895          *****************************************************************************/
 896          void Message_Handler(void)
 897          {
 898   1        Message_Status=0;
 899   1        write_dgus_vp(MESSAGE_STATUS,(u8*)&Message_Status,1);
 900   1        
 901   1              Return_Main_page();
 902   1      }
 903          
 904          
 905          void Shut_Down_Handler(void)
 906          { 
 907   1        Write_Nor_Flash();
 908   1        POWER_OFF();
 909   1      }
 910          
 911          
 912          
 913          void Speed_Auto_Set_Handler(void)
 914          {
 915   1        Wind_Speed=4;
 916   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 917   1      }
 918          
 919          
 920          void Speed_Low_Set_Handler(void)
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 16  

 921          {
 922   1        Wind_Speed=1;
 923   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 924   1      }
 925          
 926          void Speed_Medium_Set_Handler(void)
 927          {
 928   1        Wind_Speed=2;
 929   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 930   1      }
 931          
 932          
 933          void Speed_High_Set_Handler(void)
 934          {
 935   1        Wind_Speed=3;
 936   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 937   1      }
 938          
 939          
 940          void Speed_Add_Set_Handler(void)
 941          {
 942   1        Wind_Speed++;
 943   1        if(Wind_Speed>4)
 944   1        {
 945   2          Wind_Speed=1;
 946   2        }
 947   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 948   1      }
 949          
 950          
 951          void Speed_Decrease_Set_Handler(void)
 952          {
 953   1        Wind_Speed--;
 954   1        if(Wind_Speed<1)
 955   1        {
 956   2          Wind_Speed=4;
 957   2        }
 958   1        write_dgus_vp(SPEED,(u8*)&Wind_Speed,1);
 959   1      }
 960          
 961          
 962          
 963          void Mode_Add_Set_Handler(void)
 964          {
 965   1        Mode++;
 966   1        if(Mode>3)
 967   1        {
 968   2          Mode=1;
 969   2        }
 970   1        write_dgus_vp(MODE,(u8*)&Mode,1);
 971   1      }
 972          
 973          void Asc_Input_Handler(u16 num)
 974          {
 975   1        u8 i;
 976   1        Asc_num = num&0x00FF;
 977   1      //  Asc_num = 12;
 978   1        write_dgus_vp(0x3200,(u8*)&num,1);
 979   1        for(i=0;i<25;i++)
 980   1        {
 981   2          input_Ascdata[i] = 0;
 982   2        }
C51 COMPILER V9.50a   CONFIG                                                               08/27/2019 16:41:23 PAGE 17  

 983   1      }
 984          
 985          
 986          
 987          
 988          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6318    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =    150      30
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
